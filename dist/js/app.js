"use strict";var _=require("lodash"),glob=require("glob");module.exports=_.extend(require("./env/all"),require("./env/"+process.env.NODE_ENV)||{}),module.exports.getGlobbedFiles=function(a,b){var c=this,d=new RegExp("^(?:[a-z]+:)?//","i"),e=[];return _.isArray(a)?a.forEach(function(a){e=_.union(e,c.getGlobbedFiles(a,b))}):_.isString(a)&&(d.test(a)?e.push(a):glob(a,{sync:!0},function(a,c){b&&(c=c.map(function(a){return a.replace(b,"")})),e=_.union(e,c)})),e},module.exports.getJavaScriptAssets=function(a){var b=this.getGlobbedFiles(this.assets.lib.js.concat(this.assets.js),"public/");return a&&(b=_.union(b,this.getGlobbedFiles(this.assets.tests))),b},module.exports.getCSSAssets=function(){var a=this.getGlobbedFiles(this.assets.lib.css.concat(this.assets.css),"public/");return a},angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("emails"),ApplicationConfiguration.registerModule("landingpages"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"}).state("sucesso",{url:"/sucesso",templateUrl:"modules/core/views/home.client.view.html"}).state("roupas",{url:"/roupas",templateUrl:"modules/core/views/home.client.view.html"}).state("eletronicos",{url:"/eletronicos",templateUrl:"modules/core/views/home.client.view.html"}).state("top",{url:"/top",templateUrl:"modules/core/views/home.client.view.html"}).state("admin",{url:"/admin",templateUrl:"modules/landingpages/views/list-landingpages.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(a,b,c){a.authentication=b,a.isCollapsed=!1,a.menu=c.getMenu("topbar"),a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(){a.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","$location","Authentication","Landingpages",function(a,b,c,d){a.authentication=c,a.find=function(){switch(console.log(b.path()),b.path()){case"/roupas":a.selectCategoria("roupas");break;case"/eletronicos":a.selectCategoria("eletronicos");break;case"/top":a.selectTopItems("top");break;default:a.findItems()}},a.findItems=function(){a.landingpages=d.query(function(a){for(var b=0;b<a.length;b++)if(a[b].precoPara.indexOf(",")>-1){var c=a[b].precoPara.split(",");a[b].precoParaInteiro=c[0],a[b].precoParaCentavos=","+c[1]}else a[b].precoParaInteiro=a[b].precoPara})},a.selectTopItems=function(b){console.log("AKI"),angular.element(document.getElementById("eletronicos")).addClass("menu"),angular.element(document.getElementById("eletronicos")).css("color",""),angular.element(document.getElementById("roupas")).addClass("menu"),angular.element(document.getElementById("roupas")).css("color",""),angular.element(document.getElementById("top")).css("color","#219acc"),a.landingpages=d.query(function(c){for(var d=[],e=0;e<c.length;e++)if(c[e].top){if(c[e].precoPara.indexOf(",")>-1){var f=c[e].precoPara.split(",");c[e].precoParaInteiro=f[0],c[e].precoParaCentavos=","+f[1]}else c[e].precoParaInteiro=c[e].precoPara;d.push(c[e])}a.filtro=b,a.landingpages=d})},a.selectCategoria=function(b){angular.element(document.getElementById("top")).addClass("menu"),angular.element(document.getElementById("top")).css("color",""),angular.element(document.getElementById("eletronicos")).addClass("menu"),angular.element(document.getElementById("eletronicos")).css("color",""),angular.element(document.getElementById("roupas")).addClass("menu"),angular.element(document.getElementById("roupas")).css("color",""),angular.element(document.getElementById(b)).css("color","#219acc"),a.landingpages=d.query(function(c){for(var d=[],e=0;e<c.length;e++)if(c[e].categoria===b){if(c[e].precoPara.indexOf(",")>-1){var f=c[e].precoPara.split(",");c[e].precoParaInteiro=f[0],c[e].precoParaCentavos=","+f[1]}else c[e].precoParaInteiro=c[e].precoPara;d.push(c[e])}a.categoria=b,a.landingpages=d})}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var a=function(a){if(!a)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c,d){return this.menus[b]={isPublic:c||!1,roles:d||this.defaultRoles,items:[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c,d,e,f,g,h,i){return this.validateMenuExistance(b),this.menus[b].items.push({title:c,link:d,menuItemType:e||"item",menuItemClass:e,uiRoute:f||"/"+d,isPublic:null===g||"undefined"==typeof g?this.menus[b].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].roles:h,position:i||0,items:[],shouldRender:a}),this.menus[b]},this.addSubMenuItem=function(b,c,d,e,f,g,h,i){this.validateMenuExistance(b);for(var j in this.menus[b].items)this.menus[b].items[j].link===c&&this.menus[b].items[j].items.push({title:d,link:e,uiRoute:f||"/"+e,isPublic:null===g||"undefined"==typeof g?this.menus[b].items[j].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].items[j].roles:h,position:i||0,shouldRender:a});return this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].link===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)for(var d in this.menus[a].items[c].items)this.menus[a].items[c].items[d].link===b&&this.menus[a].items[c].items.splice(d,1);return this.menus[a]},this.addMenu("topbar")}]),angular.module("emails").run(["Menus",function(a){a.addMenuItem("topbar","Emails","emails","dropdown","/emails(/create)?"),a.addSubMenuItem("topbar","emails","download","emails")}]),angular.module("emails").config(["$stateProvider",function(a){a.state("listEmails",{url:"/emails",templateUrl:"modules/emails/views/list-emails.client.view.html"}).state("createEmail",{url:"/emails/create",templateUrl:"modules/emails/views/create-email.client.view.html"}).state("viewEmail",{url:"/emails/:emailId",templateUrl:"modules/emails/views/view-email.client.view.html"}).state("editEmail",{url:"/emails/:emailId/edit",templateUrl:"modules/emails/views/edit-email.client.view.html"})}]),angular.module("emails").controller("EmailsController",["$scope","$stateParams","$location","Authentication","Emails",function(a,b,c,d,e){a.authentication=d,a.totalItems=64,a.currentPage=4,a.setPage=function(b){a.currentPage=b},a.pageChanged=function(){console.log("Page changed to: "+a.currentPage)},a.maxSize=5,a.bigTotalItems=175,a.bigCurrentPage=1,a.create=function(){var b=new e({email:this.email});b.$save(function(b){c.path("emails/"+b._id),a.email=""},function(b){a.error=b.data.message})},a.getEmails=function(){console.log(a.emails);var b=[];for(var c in a.emails){var d=new Date(a.emails[c].created),e=d.getFullYear().toString(),f=(d.getMonth()+1).toString(),g=d.getDate().toString(),h=f.split(""),i=g.split(""),j=(i[1]?g:"0"+i[0])+"/"+(h[1]?f:"0"+h[0])+"/"+e;b[c]={a:a.emails[c].email,b:j}}return b},a.createEmailOnHome=function(){var b=new e({email:this.email});b.$save(function(){a.emailCreated=!0,c.path("sucesso"),a.email=""},function(b){a.error=b.data.message})},a.remove=function(b){if(b){b.$remove();for(var d in a.emails)a.emails[d]===b&&a.emails.splice(d,1)}else a.email.$remove(function(){c.path("emails")})},a.update=function(){var b=a.email;b.$update(function(){c.path("emails/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.emails=e.query()},a.findLimit=function(){a.emails=e.query()},a.findOne=function(){a.email=e.get({emailId:b.emailId})}}]),angular.module("emails").factory("Emails",["$resource",function(a){return a("emails/:emailId",{emailId:"@_id"},{update:{method:"PUT"}})}]),angular.module("landingpages").run(["Menus",function(a){a.addMenuItem("topbar","Cadastro de Ofertas","landingpages","dropdown","admin/landingpages(/create)?"),a.addSubMenuItem("topbar","landingpages","listar","admin/landingpages"),a.addSubMenuItem("topbar","landingpages","nova","admin/landingpages/create")}]),angular.module("landingpages").config(["$stateProvider",function(a){a.state("listLandingpages",{url:"/admin/landingpages",templateUrl:"modules/landingpages/views/list-landingpages.client.view.html"}).state("createLandingpage",{url:"/admin/landingpages/create",templateUrl:"modules/landingpages/views/create-landingpage.client.view.html"}).state("viewLandingpage",{url:"/admin/landingpages/:landingpageId",templateUrl:"modules/landingpages/views/view-landingpage.client.view.html"}).state("editLandingpage",{url:"/admin/landingpages/:landingpageId/edit",templateUrl:"modules/landingpages/views/edit-landingpage.client.view.html"})}]),angular.module("landingpages").controller("LandingpagesController",["$scope","$http","$upload","$stateParams","$location","Authentication","Landingpages",function(a,b,c,d,e,f,g){a.authentication=f,a.loadingImage=0,""===a.authentication.user&&"/"!==e.path()&&e.path("signin"),a.selectTopItems=function(b){angular.element(document.getElementById("eletronicos")).addClass("menu"),angular.element(document.getElementById("eletronicos")).css("color",""),angular.element(document.getElementById("roupas")).addClass("menu"),angular.element(document.getElementById("roupas")).css("color",""),angular.element(document.getElementById("top")).css("color","#219acc"),a.landingpages=g.query(function(c){for(var d=[],e=0;e<c.length;e++)if(c[e].top){if(c[e].precoPara.indexOf(",")>-1){var f=c[e].precoPara.split(",");c[e].precoParaInteiro=f[0],c[e].precoParaCentavos=","+f[1]}else c[e].precoParaInteiro=c[e].precoPara;d.push(c[e])}a.filtro=b,a.landingpages=d})},a.selectCategoria=function(b){angular.element(document.getElementById("top")).addClass("menu"),angular.element(document.getElementById("top")).css("color",""),angular.element(document.getElementById("eletronicos")).addClass("menu"),angular.element(document.getElementById("eletronicos")).css("color",""),angular.element(document.getElementById("roupas")).addClass("menu"),angular.element(document.getElementById("roupas")).css("color",""),angular.element(document.getElementById(b)).css("color","#219acc"),a.landingpages=g.query(function(c){for(var d=[],e=0;e<c.length;e++)if(c[e].categoria===b){if(c[e].precoPara.indexOf(",")>-1){var f=c[e].precoPara.split(",");c[e].precoParaInteiro=f[0],c[e].precoParaCentavos=","+f[1]}else c[e].precoParaInteiro=c[e].precoPara;d.push(c[e])}a.categoria=b,a.landingpages=d})},a.create=function(){var b=!1;this.novidade&&(b=!0);var c=!1;this.top&&(c=!0);var d=new g({nome:this.nome,categoria:this.categoria,descricao:this.descricao,precoDe:this.precoDe,precoPara:this.precoPara,link:this.link,imagem:this.imagem,desconto:this.desconto,novidade:b,top:c});d.$save(function(){e.path("admin/landingpages"),a.nome="",a.descricao="",a.categoria="",a.precoDe="",a.precoPara="",a.link="",a.imagem="",a.desconto="",a.novidade="",a.top=""},function(b){a.error=b.data.message})},a.remove=function(b){if(console.log(b),b){b.$remove();for(var c in a.landingpages)a.landingpages[c]===b&&a.landingpages.splice(c,1);e.path("admin/landingpages")}else a.landingpage.$remove(function(){e.path("admin/landingpages")})},a.update=function(){a.landingpage.imagem=a.imagem;var b=a.landingpage;b.$update(function(){e.path("admin/landingpages")},function(b){a.error=b.data.message})},a.find=function(){a.landingpages=g.query(function(a){for(var b=0;b<a.length;b++)if(a[b].precoPara.indexOf(",")>-1){var c=a[b].precoPara.split(",");a[b].precoParaInteiro=c[0],a[b].precoParaCentavos=","+c[1]}else a[b].precoParaInteiro=a[b].precoPara})},a.findOne=function(){a.showImage=!0,a.landingpage=g.get({landingpageId:d.landingpageId})},a.findByCategoria=function(){a.showImage=!0,a.landingpage=g.get({categoria:d.categoria})},a.onFileSelect=function(b){if(0===b.length)a.deleteFile();else{var d=b[0];a.upload=c.upload({url:"/admin/landingpages/upload",method:"POST",data:{myObj:a.landingpages},file:d}).progress(function(b){a.loadingImage=parseInt(100*b.loaded/b.total)}).success(function(b){a.imagem=b.fileName,a.showImage=!0;var c=e.path();"/admin/landingpages/create"!==c&&a.landingpage.imagem&&(a.landingpage.imagem=a.imagem)})}},a.deleteFile=function(){document.getElementById("imagemId").value="",a.imagem="",a.loadingImage=0,a.showImage=!1}}]),angular.module("landingpages").factory("Landingpages",["$resource",function(a){return a("admin/landingpages/:landingpageId",{landingpageId:"@_id"},{update:{method:"PUT"},upload:{method:"POST"}})}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invlaid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(a,b,c,d){a.authentication=d,a.authentication.user&&c.path("/"),a.signup=function(){b.post("/auth/signup",a.credentials).success(function(b){a.authentication.user=b,c.path("/admin/landingpages")}).error(function(b){a.error=b.message})},a.signin=function(){b.post("/auth/signin",a.credentials).success(function(b){a.authentication.user=b,c.path("/admin/landingpages")}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(a,b,c,d,e){a.authentication=e,a.authentication.user&&d.path("/"),a.askForPasswordReset=function(){a.success=a.error=null,c.post("/auth/forgot",a.credentials).success(function(b){a.credentials=null,a.success=b.message}).error(function(b){a.credentials=null,a.error=b.message})},a.resetUserPassword=function(){a.success=a.error=null,c.post("/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.passwordDetails=null,e.user=b,d.path("/password/reset/success")}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function(a,b,c,d,e){a.user=e.user,a.user||c.path("/"),a.hasConnectedAdditionalSocialAccounts=function(){for(var b in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(c){a.success=a.error=null,b.delete("/users/accounts",{params:{provider:c}}).success(function(b){a.success=!0,a.user=e.user=b}).error(function(b){a.error=b.message})},a.updateUserProfile=function(b){if(b){a.success=a.error=null;var c=new d(a.user);c.$update(function(b){a.success=!0,e.user=b},function(b){a.error=b.data.message})}else a.submitted=!0},a.changeUserPassword=function(){a.success=a.error=null,b.post("/users/password",a.passwordDetails).success(function(){a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message})}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").factory("Users",["$resource",function(a){return a("users",{},{update:{method:"PUT"}})}]);